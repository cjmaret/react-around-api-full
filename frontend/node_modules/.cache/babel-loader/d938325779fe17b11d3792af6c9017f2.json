{"ast":null,"code":"import _toConsumableArray from\"/Users/colinmaretsky/dev/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/colinmaretsky/dev/react-around-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable no-restricted-globals */import React from\"react\";import{Switch,Route,useHistory}from\"react-router-dom\";import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import EditProfilePopup from\"./EditProfilePopup\";import AddPlacePopup from\"./AddPlacePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import DeleteCardPopup from\"./DeleteCardPopup\";import ImagePopup from\"./ImagePopup\";import Login from\"./Login\";import Register from\"./Register\";import api from\"../utils/api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import InfoTooltip from\"./InfoTooltip\";import ProtectedRoute from\"./ProtectedRoute\";import*as auth from\"../auth.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var history=useHistory();var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setIsEditProfilePopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setIsAddPlacePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setIsEditAvatarPopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isDeleteCardPopupOpen=_React$useState8[0],setIsDeleteCardPopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isInfoTooltipPopupOpen=_React$useState10[0],setIsInfoTooltipPopupOpen=_React$useState10[1];var _React$useState11=React.useState(),_React$useState12=_slicedToArray(_React$useState11,2),selectedCard=_React$useState12[0],setSelectedCard=_React$useState12[1];var _React$useState13=React.useState(),_React$useState14=_slicedToArray(_React$useState13,2),currentUser=_React$useState14[0],setCurrentUser=_React$useState14[1];var _React$useState15=React.useState([]),_React$useState16=_slicedToArray(_React$useState15,2),cards=_React$useState16[0],setCards=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isLoading=_React$useState18[0],setIsLoading=_React$useState18[1];var _React$useState19=React.useState(),_React$useState20=_slicedToArray(_React$useState19,2),cardToDelete=_React$useState20[0],setCardToDelete=_React$useState20[1];var _React$useState21=React.useState(true),_React$useState22=_slicedToArray(_React$useState21,2),loggedIn=_React$useState22[0],setloggedIn=_React$useState22[1];var _React$useState23=React.useState(\"\"),_React$useState24=_slicedToArray(_React$useState23,2),email=_React$useState24[0],setEmail=_React$useState24[1];var _React$useState25=React.useState(\"\"),_React$useState26=_slicedToArray(_React$useState25,2),password=_React$useState26[0],setPassword=_React$useState26[1];React.useEffect(function(){api.getUserInfo().then(function(res){setCurrentUser(res);}).catch(function(err){return console.log(err);});},[]);React.useEffect(function(){// handleTokenCheck();\nconsole.log(email);console.log(password);});// function handleTokenCheck() {\n//   if (localStorage.getItem(\"token\")) {\n//     const jwt = localStorage.getItem(\"jwt\");\n//     auth.checkToken(jwt).then((res) => {});\n//   }\n// }\nfunction handleEditProfileClick(){setIsLoading(false);setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsLoading(false);setIsAddPlacePopupOpen(true);}function handleEditAvatarClick(){setIsLoading(false);setIsEditAvatarPopupOpen(true);}function handleDeleteCardClick(clickedCard){setIsLoading(false);setIsDeleteCardPopupOpen(true);setCardToDelete(clickedCard);}function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsDeleteCardPopupOpen(false);setIsInfoTooltipPopupOpen(false);setSelectedCard();}function handleCardClick(clickedCard){setSelectedCard(clickedCard);}function handleUpdateUser(info){api.setUserInfo(info).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleUpdateAvatar(info){api.setUserAvatar(info).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleAddPlaceSubmit(_ref){var link=_ref.link,name=_ref.name;api.addCard({link:link,name:name}).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){return console.log(err);});}function handleEmailChange(e){setEmail(e.target.value);}function handlePasswordChange(e){setPassword(e.target.value);}function handleRegisterSubmit(e){e.preventDefault();auth.register(email,password).then(function(res){if(res){history.push(\"/login\");}else{console.log(\"Something went wrong\");}});setIsInfoTooltipPopupOpen(true);}function handleLoginSubmit(e){e.preventDefault();auth.authorize(email,password).then(function(data){if(data.token){setEmail(\"\");setPassword(\"\");handleLogin();history.push(\"/\");}}).catch(function(err){return console.log(err);});}function handleLogin(e){e.preventDefault();setloggedIn(true);}React.useEffect(function(){api.getCardList().then(function(res){setCards(res);}).catch(function(err){return console.log(err);});},[]);function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===(currentUser===null||currentUser===void 0?void 0:currentUser._id);});if(!isLiked){api.addLike(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){return console.log(err);});}else{api.removeLike(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){return console.log(err);});}}function handleCardDelete(card){api.removeCard(card._id).then(function(){setCards(function(state){return state.filter(function(c){return c._id!==card._id;});});closeAllPopups();}).catch(function(err){return console.log(err);});}function handleChangeButtonText(){setIsLoading(true);}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsxs(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,pageLink:\"/login\",linkTitle:\"Log out\"}),/*#__PURE__*/_jsx(Main,{onCardClick:handleCardClick,onEditProfileClick:handleEditProfileClick,onAddPlaceClick:handleAddPlaceClick,onEditAvatarClick:handleEditAvatarClick,cards:cards,onCardLike:handleCardLike,onDeleteCardClick:handleDeleteCardClick}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,isLoading:isLoading,onRenderLoading:handleChangeButtonText}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlaceSubmit:handleAddPlaceSubmit,isLoading:isLoading,onRenderLoading:handleChangeButtonText}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar,isLoading:isLoading,onRenderLoading:handleChangeButtonText}),/*#__PURE__*/_jsx(DeleteCardPopup,{cardToDelete:cardToDelete,isOpen:isDeleteCardPopupOpen,onClose:closeAllPopups,onDeleteCardSubmit:handleCardDelete,isLoading:isLoading,onRenderLoading:handleChangeButtonText}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups})]}),/*#__PURE__*/_jsx(Route,{path:\"/login\",children:/*#__PURE__*/_jsx(Login,{email:email,password:password,setEmail:setEmail,setPassword:setPassword,onEmailChange:handleEmailChange,onPasswordChange:handlePasswordChange,onLoginSubmit:handleLoginSubmit})}),/*#__PURE__*/_jsxs(Route,{path:\"/register\",children:[/*#__PURE__*/_jsx(Register,{email:email,password:password,setEmail:setEmail,setPassword:setPassword,onEmailChange:handleEmailChange,onPasswordChange:handlePasswordChange,onRegisterSubmit:handleRegisterSubmit}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipPopupOpen,onClose:closeAllPopups})]})]})});}export default App;","map":{"version":3,"sources":["/Users/colinmaretsky/dev/react-around-auth/src/components/App.js"],"names":["React","Switch","Route","useHistory","Header","Main","Footer","EditProfilePopup","AddPlacePopup","EditAvatarPopup","DeleteCardPopup","ImagePopup","Login","Register","api","CurrentUserContext","InfoTooltip","ProtectedRoute","auth","App","history","useState","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isDeleteCardPopupOpen","setIsDeleteCardPopupOpen","isInfoTooltipPopupOpen","setIsInfoTooltipPopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","isLoading","setIsLoading","cardToDelete","setCardToDelete","loggedIn","setloggedIn","email","setEmail","password","setPassword","useEffect","getUserInfo","then","res","catch","err","console","log","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleDeleteCardClick","clickedCard","closeAllPopups","handleCardClick","handleUpdateUser","info","setUserInfo","handleUpdateAvatar","setUserAvatar","handleAddPlaceSubmit","link","name","addCard","newCard","handleEmailChange","e","target","value","handlePasswordChange","handleRegisterSubmit","preventDefault","register","push","handleLoginSubmit","authorize","data","token","handleLogin","getCardList","handleCardLike","card","isLiked","likes","some","i","_id","addLike","state","map","c","removeLike","handleCardDelete","removeCard","filter","handleChangeButtonText"],"mappings":"0UAAA,0CACA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,MAAT,CAAiBC,KAAjB,CAAwBC,UAAxB,KAA0C,kBAA1C,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,IAAP,KAAiB,QAAjB,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,oBAA7B,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CACA,MAAOC,CAAAA,eAAP,KAA4B,mBAA5B,CACA,MAAOC,CAAAA,eAAP,KAA4B,mBAA5B,CACA,MAAOC,CAAAA,UAAP,KAAuB,cAAvB,CACA,MAAOC,CAAAA,KAAP,KAAkB,SAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,YAArB,CACA,MAAOC,CAAAA,GAAP,KAAgB,cAAhB,CACA,OAASC,kBAAT,KAAmC,gCAAnC,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,CACA,MAAOC,CAAAA,cAAP,KAA2B,kBAA3B,CACA,MAAO,GAAKC,CAAAA,IAAZ,KAAsB,YAAtB,C,wFAEA,QAASC,CAAAA,GAAT,EAAe,CACb,GAAMC,CAAAA,OAAO,CAAGjB,UAAU,EAA1B,CACA,oBACEH,KAAK,CAACqB,QAAN,CAAe,KAAf,CADF,oDAAOC,sBAAP,qBAA+BC,yBAA/B,qBAEA,qBAAsDvB,KAAK,CAACqB,QAAN,CAAe,KAAf,CAAtD,qDAAOG,mBAAP,qBAA4BC,sBAA5B,qBACA,qBACEzB,KAAK,CAACqB,QAAN,CAAe,KAAf,CADF,qDAAOK,qBAAP,qBAA8BC,wBAA9B,qBAEA,qBACE3B,KAAK,CAACqB,QAAN,CAAe,KAAf,CADF,qDAAOO,qBAAP,qBAA8BC,wBAA9B,qBAEA,qBACE7B,KAAK,CAACqB,QAAN,CAAe,KAAf,CADF,sDAAOS,sBAAP,sBAA+BC,yBAA/B,sBAEA,sBAAwC/B,KAAK,CAACqB,QAAN,EAAxC,uDAAOW,YAAP,sBAAqBC,eAArB,sBACA,sBAAsCjC,KAAK,CAACqB,QAAN,EAAtC,uDAAOa,WAAP,sBAAoBC,cAApB,sBACA,sBAA0BnC,KAAK,CAACqB,QAAN,CAAe,EAAf,CAA1B,uDAAOe,KAAP,sBAAcC,QAAd,sBACA,sBAAkCrC,KAAK,CAACqB,QAAN,CAAe,KAAf,CAAlC,uDAAOiB,SAAP,sBAAkBC,YAAlB,sBACA,sBAAwCvC,KAAK,CAACqB,QAAN,EAAxC,uDAAOmB,YAAP,sBAAqBC,eAArB,sBACA,sBAAgCzC,KAAK,CAACqB,QAAN,CAAe,IAAf,CAAhC,uDAAOqB,QAAP,sBAAiBC,WAAjB,sBACA,sBAA0B3C,KAAK,CAACqB,QAAN,CAAe,EAAf,CAA1B,uDAAOuB,KAAP,sBAAcC,QAAd,sBACA,sBAAgC7C,KAAK,CAACqB,QAAN,CAAe,EAAf,CAAhC,uDAAOyB,QAAP,sBAAiBC,WAAjB,sBAEA/C,KAAK,CAACgD,SAAN,CAAgB,UAAM,CACpBlC,GAAG,CACAmC,WADH,GAEGC,IAFH,CAEQ,SAACC,GAAD,CAAS,CACbhB,cAAc,CAACgB,GAAD,CAAd,CACD,CAJH,EAKGC,KALH,CAKS,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EALT,EAMD,CAPD,CAOG,EAPH,EASArD,KAAK,CAACgD,SAAN,CAAgB,UAAM,CACpB;AACAM,OAAO,CAACC,GAAR,CAAYX,KAAZ,EACAU,OAAO,CAACC,GAAR,CAAYT,QAAZ,EACD,CAJD,EAMA;AACA;AACA;AAEA;AACA;AACA;AAEA,QAASU,CAAAA,sBAAT,EAAkC,CAChCjB,YAAY,CAAC,KAAD,CAAZ,CACAhB,yBAAyB,CAAC,IAAD,CAAzB,CACD,CAED,QAASkC,CAAAA,mBAAT,EAA+B,CAC7BlB,YAAY,CAAC,KAAD,CAAZ,CACAd,sBAAsB,CAAC,IAAD,CAAtB,CACD,CAED,QAASiC,CAAAA,qBAAT,EAAiC,CAC/BnB,YAAY,CAAC,KAAD,CAAZ,CACAZ,wBAAwB,CAAC,IAAD,CAAxB,CACD,CAED,QAASgC,CAAAA,qBAAT,CAA+BC,WAA/B,CAA4C,CAC1CrB,YAAY,CAAC,KAAD,CAAZ,CACAV,wBAAwB,CAAC,IAAD,CAAxB,CACAY,eAAe,CAACmB,WAAD,CAAf,CACD,CAED,QAASC,CAAAA,cAAT,EAA0B,CACxBtC,yBAAyB,CAAC,KAAD,CAAzB,CACAE,sBAAsB,CAAC,KAAD,CAAtB,CACAE,wBAAwB,CAAC,KAAD,CAAxB,CACAE,wBAAwB,CAAC,KAAD,CAAxB,CACAE,yBAAyB,CAAC,KAAD,CAAzB,CACAE,eAAe,GAChB,CAED,QAAS6B,CAAAA,eAAT,CAAyBF,WAAzB,CAAsC,CACpC3B,eAAe,CAAC2B,WAAD,CAAf,CACD,CAED,QAASG,CAAAA,gBAAT,CAA0BC,IAA1B,CAAgC,CAC9BlD,GAAG,CACAmD,WADH,CACeD,IADf,EAEGd,IAFH,CAEQ,SAACC,GAAD,CAAS,CACbhB,cAAc,CAACgB,GAAD,CAAd,CACAU,cAAc,GACf,CALH,EAMGT,KANH,CAMS,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EANT,EAOD,CAED,QAASa,CAAAA,kBAAT,CAA4BF,IAA5B,CAAkC,CAChClD,GAAG,CACAqD,aADH,CACiBH,IADjB,EAEGd,IAFH,CAEQ,SAACC,GAAD,CAAS,CACbhB,cAAc,CAACgB,GAAD,CAAd,CACAU,cAAc,GACf,CALH,EAMGT,KANH,CAMS,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EANT,EAOD,CAED,QAASe,CAAAA,oBAAT,MAA8C,IAAdC,CAAAA,IAAc,MAAdA,IAAc,CAARC,IAAQ,MAARA,IAAQ,CAC5CxD,GAAG,CACAyD,OADH,CACW,CAAEF,IAAI,CAAJA,IAAF,CAAQC,IAAI,CAAJA,IAAR,CADX,EAEGpB,IAFH,CAEQ,SAACsB,OAAD,CAAa,CACjBnC,QAAQ,EAAEmC,OAAF,4BAAcpC,KAAd,GAAR,CACAyB,cAAc,GACf,CALH,EAMGT,KANH,CAMS,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EANT,EAOD,CAED,QAASoB,CAAAA,iBAAT,CAA2BC,CAA3B,CAA8B,CAC5B7B,QAAQ,CAAC6B,CAAC,CAACC,MAAF,CAASC,KAAV,CAAR,CACD,CAED,QAASC,CAAAA,oBAAT,CAA8BH,CAA9B,CAAiC,CAC/B3B,WAAW,CAAC2B,CAAC,CAACC,MAAF,CAASC,KAAV,CAAX,CACD,CAED,QAASE,CAAAA,oBAAT,CAA8BJ,CAA9B,CAAiC,CAC/BA,CAAC,CAACK,cAAF,GACA7D,IAAI,CAAC8D,QAAL,CAAcpC,KAAd,CAAqBE,QAArB,EACCI,IADD,CACM,SAACC,GAAD,CAAS,CACb,GAAIA,GAAJ,CAAS,CACP/B,OAAO,CAAC6D,IAAR,CAAa,QAAb,EACD,CAFD,IAEO,CACL3B,OAAO,CAACC,GAAR,CAAY,sBAAZ,EACD,CACF,CAPD,EAQAxB,yBAAyB,CAAC,IAAD,CAAzB,CACD,CAED,QAASmD,CAAAA,iBAAT,CAA2BR,CAA3B,CAA8B,CAC5BA,CAAC,CAACK,cAAF,GACA7D,IAAI,CACDiE,SADH,CACavC,KADb,CACoBE,QADpB,EAEGI,IAFH,CAEQ,SAACkC,IAAD,CAAU,CACd,GAAIA,IAAI,CAACC,KAAT,CAAgB,CACdxC,QAAQ,CAAC,EAAD,CAAR,CACAE,WAAW,CAAC,EAAD,CAAX,CACAuC,WAAW,GACXlE,OAAO,CAAC6D,IAAR,CAAa,GAAb,EACD,CACF,CATH,EAUG7B,KAVH,CAUS,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EAVT,EAWD,CAED,QAASiC,CAAAA,WAAT,CAAqBZ,CAArB,CAAwB,CACtBA,CAAC,CAACK,cAAF,GACApC,WAAW,CAAC,IAAD,CAAX,CACD,CAED3C,KAAK,CAACgD,SAAN,CAAgB,UAAM,CACpBlC,GAAG,CACAyE,WADH,GAEGrC,IAFH,CAEQ,SAACC,GAAD,CAAS,CACbd,QAAQ,CAACc,GAAD,CAAR,CACD,CAJH,EAKGC,KALH,CAKS,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EALT,EAMD,CAPD,CAOG,EAPH,EASA,QAASmC,CAAAA,cAAT,CAAwBC,IAAxB,CAA8B,CAC5B,GAAMC,CAAAA,OAAO,CAAGD,IAAI,CAACE,KAAL,CAAWC,IAAX,CAAgB,SAACC,CAAD,QAAOA,CAAAA,CAAC,CAACC,GAAF,IAAU5D,WAAV,SAAUA,WAAV,iBAAUA,WAAW,CAAE4D,GAAvB,CAAP,EAAhB,CAAhB,CACA,GAAI,CAACJ,OAAL,CAAc,CACZ5E,GAAG,CACAiF,OADH,CACWN,IAAI,CAACK,GADhB,CACqB,CAACJ,OADtB,EAEGxC,IAFH,CAEQ,SAACsB,OAAD,CAAa,CACjBnC,QAAQ,CAAC,SAAC2D,KAAD,QACPA,CAAAA,KAAK,CAACC,GAAN,CAAU,SAACC,CAAD,QAAQA,CAAAA,CAAC,CAACJ,GAAF,GAAUL,IAAI,CAACK,GAAf,CAAqBtB,OAArB,CAA+B0B,CAAvC,EAAV,CADO,EAAD,CAAR,CAGD,CANH,EAOG9C,KAPH,CAOS,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EAPT,EAQD,CATD,IASO,CACLvC,GAAG,CACAqF,UADH,CACcV,IAAI,CAACK,GADnB,CACwB,CAACJ,OADzB,EAEGxC,IAFH,CAEQ,SAACsB,OAAD,CAAa,CACjBnC,QAAQ,CAAC,SAAC2D,KAAD,QACPA,CAAAA,KAAK,CAACC,GAAN,CAAU,SAACC,CAAD,QAAQA,CAAAA,CAAC,CAACJ,GAAF,GAAUL,IAAI,CAACK,GAAf,CAAqBtB,OAArB,CAA+B0B,CAAvC,EAAV,CADO,EAAD,CAAR,CAGD,CANH,EAOG9C,KAPH,CAOS,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EAPT,EAQD,CACF,CAED,QAAS+C,CAAAA,gBAAT,CAA0BX,IAA1B,CAAgC,CAC9B3E,GAAG,CACAuF,UADH,CACcZ,IAAI,CAACK,GADnB,EAEG5C,IAFH,CAEQ,UAAM,CACVb,QAAQ,CAAC,SAAC2D,KAAD,QAAWA,CAAAA,KAAK,CAACM,MAAN,CAAa,SAACJ,CAAD,QAAOA,CAAAA,CAAC,CAACJ,GAAF,GAAUL,IAAI,CAACK,GAAtB,EAAb,CAAX,EAAD,CAAR,CACAjC,cAAc,GACf,CALH,EAMGT,KANH,CAMS,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EANT,EAOD,CAED,QAASkD,CAAAA,sBAAT,EAAkC,CAChChE,YAAY,CAAC,IAAD,CAAZ,CACD,CAED,mBACE,KAAC,kBAAD,CAAoB,QAApB,EAA6B,KAAK,CAAEL,WAApC,uBACE,MAAC,MAAD,yBACE,MAAC,cAAD,EAAgB,KAAK,KAArB,CAAsB,IAAI,CAAC,GAA3B,CAA+B,QAAQ,CAAEQ,QAAzC,wBACE,KAAC,MAAD,EAAQ,QAAQ,CAAEA,QAAlB,CAA4B,QAAQ,CAAC,QAArC,CAA8C,SAAS,CAAC,SAAxD,EADF,cAEE,KAAC,IAAD,EACE,WAAW,CAAEoB,eADf,CAEE,kBAAkB,CAAEN,sBAFtB,CAGE,eAAe,CAAEC,mBAHnB,CAIE,iBAAiB,CAAEC,qBAJrB,CAKE,KAAK,CAAEtB,KALT,CAME,UAAU,CAAEoD,cANd,CAOE,iBAAiB,CAAE7B,qBAPrB,EAFF,cAWE,KAAC,MAAD,IAXF,cAYE,KAAC,gBAAD,EACE,MAAM,CAAErC,sBADV,CAEE,OAAO,CAAEuC,cAFX,CAGE,YAAY,CAAEE,gBAHhB,CAIE,SAAS,CAAEzB,SAJb,CAKE,eAAe,CAAEiE,sBALnB,EAZF,cAmBE,KAAC,aAAD,EACE,MAAM,CAAE/E,mBADV,CAEE,OAAO,CAAEqC,cAFX,CAGE,gBAAgB,CAAEO,oBAHpB,CAIE,SAAS,CAAE9B,SAJb,CAKE,eAAe,CAAEiE,sBALnB,EAnBF,cA0BE,KAAC,eAAD,EACE,MAAM,CAAE7E,qBADV,CAEE,OAAO,CAAEmC,cAFX,CAGE,cAAc,CAAEK,kBAHlB,CAIE,SAAS,CAAE5B,SAJb,CAKE,eAAe,CAAEiE,sBALnB,EA1BF,cAiCE,KAAC,eAAD,EACE,YAAY,CAAE/D,YADhB,CAEE,MAAM,CAAEZ,qBAFV,CAGE,OAAO,CAAEiC,cAHX,CAIE,kBAAkB,CAAEuC,gBAJtB,CAKE,SAAS,CAAE9D,SALb,CAME,eAAe,CAAEiE,sBANnB,EAjCF,cAyCE,KAAC,UAAD,EAAY,IAAI,CAAEvE,YAAlB,CAAgC,OAAO,CAAE6B,cAAzC,EAzCF,GADF,cA4CE,KAAC,KAAD,EAAO,IAAI,CAAC,QAAZ,uBACE,KAAC,KAAD,EACE,KAAK,CAAEjB,KADT,CAEE,QAAQ,CAAEE,QAFZ,CAGE,QAAQ,CAAED,QAHZ,CAIE,WAAW,CAAEE,WAJf,CAKE,aAAa,CAAE0B,iBALjB,CAME,gBAAgB,CAAEI,oBANpB,CAOE,aAAa,CAAEK,iBAPjB,EADF,EA5CF,cAuDE,MAAC,KAAD,EAAO,IAAI,CAAC,WAAZ,wBACE,KAAC,QAAD,EACE,KAAK,CAAEtC,KADT,CAEE,QAAQ,CAAEE,QAFZ,CAGE,QAAQ,CAAED,QAHZ,CAIE,WAAW,CAAEE,WAJf,CAKE,aAAa,CAAE0B,iBALjB,CAME,gBAAgB,CAAEI,oBANpB,CAOE,gBAAgB,CAAEC,oBAPpB,EADF,cAUE,KAAC,WAAD,EACE,MAAM,CAAEhD,sBADV,CAEE,OAAO,CAAE+B,cAFX,EAVF,GAvDF,GADF,EADF,CA2ED,CAED,cAAe1C,CAAAA,GAAf","sourcesContent":["/* eslint-disable no-restricted-globals */\nimport React from \"react\";\nimport { Switch, Route, useHistory } from \"react-router-dom\";\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport DeleteCardPopup from \"./DeleteCardPopup\";\nimport ImagePopup from \"./ImagePopup\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport api from \"../utils/api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport * as auth from \"../auth.js\";\n\nfunction App() {\n  const history = useHistory();\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] =\n    React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] =\n    React.useState(false);\n  const [isDeleteCardPopupOpen, setIsDeleteCardPopupOpen] =\n    React.useState(false);\n  const [isInfoTooltipPopupOpen, setIsInfoTooltipPopupOpen] =\n    React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState();\n  const [currentUser, setCurrentUser] = React.useState();\n  const [cards, setCards] = React.useState([]);\n  const [isLoading, setIsLoading] = React.useState(false);\n  const [cardToDelete, setCardToDelete] = React.useState();\n  const [loggedIn, setloggedIn] = React.useState(true);\n  const [email, setEmail] = React.useState(\"\");\n  const [password, setPassword] = React.useState(\"\");\n\n  React.useEffect(() => {\n    api\n      .getUserInfo()\n      .then((res) => {\n        setCurrentUser(res);\n      })\n      .catch((err) => console.log(err));\n  }, []);\n\n  React.useEffect(() => {\n    // handleTokenCheck();\n    console.log(email);\n    console.log(password);\n  });\n\n  // function handleTokenCheck() {\n  //   if (localStorage.getItem(\"token\")) {\n  //     const jwt = localStorage.getItem(\"jwt\");\n\n  //     auth.checkToken(jwt).then((res) => {});\n  //   }\n  // }\n\n  function handleEditProfileClick() {\n    setIsLoading(false);\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsLoading(false);\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    setIsLoading(false);\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleDeleteCardClick(clickedCard) {\n    setIsLoading(false);\n    setIsDeleteCardPopupOpen(true);\n    setCardToDelete(clickedCard);\n  }\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsDeleteCardPopupOpen(false);\n    setIsInfoTooltipPopupOpen(false);\n    setSelectedCard();\n  }\n\n  function handleCardClick(clickedCard) {\n    setSelectedCard(clickedCard);\n  }\n\n  function handleUpdateUser(info) {\n    api\n      .setUserInfo(info)\n      .then((res) => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleUpdateAvatar(info) {\n    api\n      .setUserAvatar(info)\n      .then((res) => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleAddPlaceSubmit({ link, name }) {\n    api\n      .addCard({ link, name })\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleEmailChange(e) {\n    setEmail(e.target.value);\n  }\n\n  function handlePasswordChange(e) {\n    setPassword(e.target.value);\n  }\n\n  function handleRegisterSubmit(e) {\n    e.preventDefault();\n    auth.register(email, password)\n    .then((res) => {\n      if (res) {\n        history.push(\"/login\");\n      } else {\n        console.log(\"Something went wrong\");\n      }\n    });\n    setIsInfoTooltipPopupOpen(true);\n  }\n\n  function handleLoginSubmit(e) {\n    e.preventDefault();\n    auth\n      .authorize(email, password)\n      .then((data) => {\n        if (data.token) {\n          setEmail(\"\");\n          setPassword(\"\");\n          handleLogin();\n          history.push(\"/\");\n        }\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleLogin(e) {\n    e.preventDefault();\n    setloggedIn(true);\n  }\n\n  React.useEffect(() => {\n    api\n      .getCardList()\n      .then((res) => {\n        setCards(res);\n      })\n      .catch((err) => console.log(err));\n  }, []);\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some((i) => i._id === currentUser?._id);\n    if (!isLiked) {\n      api\n        .addLike(card._id, !isLiked)\n        .then((newCard) => {\n          setCards((state) =>\n            state.map((c) => (c._id === card._id ? newCard : c))\n          );\n        })\n        .catch((err) => console.log(err));\n    } else {\n      api\n        .removeLike(card._id, !isLiked)\n        .then((newCard) => {\n          setCards((state) =>\n            state.map((c) => (c._id === card._id ? newCard : c))\n          );\n        })\n        .catch((err) => console.log(err));\n    }\n  }\n\n  function handleCardDelete(card) {\n    api\n      .removeCard(card._id)\n      .then(() => {\n        setCards((state) => state.filter((c) => c._id !== card._id));\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleChangeButtonText() {\n    setIsLoading(true);\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <Switch>\n        <ProtectedRoute exact path=\"/\" loggedIn={loggedIn}>\n          <Header loggedIn={loggedIn} pageLink=\"/login\" linkTitle=\"Log out\" />\n          <Main\n            onCardClick={handleCardClick}\n            onEditProfileClick={handleEditProfileClick}\n            onAddPlaceClick={handleAddPlaceClick}\n            onEditAvatarClick={handleEditAvatarClick}\n            cards={cards}\n            onCardLike={handleCardLike}\n            onDeleteCardClick={handleDeleteCardClick}\n          />\n          <Footer />\n          <EditProfilePopup\n            isOpen={isEditProfilePopupOpen}\n            onClose={closeAllPopups}\n            onUpdateUser={handleUpdateUser}\n            isLoading={isLoading}\n            onRenderLoading={handleChangeButtonText}\n          />\n          <AddPlacePopup\n            isOpen={isAddPlacePopupOpen}\n            onClose={closeAllPopups}\n            onAddPlaceSubmit={handleAddPlaceSubmit}\n            isLoading={isLoading}\n            onRenderLoading={handleChangeButtonText}\n          />\n          <EditAvatarPopup\n            isOpen={isEditAvatarPopupOpen}\n            onClose={closeAllPopups}\n            onUpdateAvatar={handleUpdateAvatar}\n            isLoading={isLoading}\n            onRenderLoading={handleChangeButtonText}\n          />\n          <DeleteCardPopup\n            cardToDelete={cardToDelete}\n            isOpen={isDeleteCardPopupOpen}\n            onClose={closeAllPopups}\n            onDeleteCardSubmit={handleCardDelete}\n            isLoading={isLoading}\n            onRenderLoading={handleChangeButtonText}\n          />\n          <ImagePopup card={selectedCard} onClose={closeAllPopups} />\n        </ProtectedRoute>\n        <Route path=\"/login\">\n          <Login\n            email={email}\n            password={password}\n            setEmail={setEmail}\n            setPassword={setPassword}\n            onEmailChange={handleEmailChange}\n            onPasswordChange={handlePasswordChange}\n            onLoginSubmit={handleLoginSubmit}\n          />\n        </Route>\n        <Route path=\"/register\">\n          <Register\n            email={email}\n            password={password}\n            setEmail={setEmail}\n            setPassword={setPassword}\n            onEmailChange={handleEmailChange}\n            onPasswordChange={handlePasswordChange}\n            onRegisterSubmit={handleRegisterSubmit}\n          />\n          <InfoTooltip\n            isOpen={isInfoTooltipPopupOpen}\n            onClose={closeAllPopups}\n          />\n        </Route>\n      </Switch>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}