{"ast":null,"code":"import _toConsumableArray from\"/Users/colinmaretsky/dev/react-around-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/colinmaretsky/dev/react-around-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable no-restricted-globals */import React from\"react\";import{Switch,Route,useHistory}from\"react-router-dom\";import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import EditProfilePopup from\"./EditProfilePopup\";import AddPlacePopup from\"./AddPlacePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import DeleteCardPopup from\"./DeleteCardPopup\";import ImagePopup from\"./ImagePopup\";import Login from\"./Login\";import Register from\"./Register\";import api from\"../utils/api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import InfoTooltip from\"./InfoTooltip\";import ProtectedRoute from\"./ProtectedRoute\";import*as auth from\"../utils/auth.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var history=useHistory();var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setIsEditProfilePopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setIsAddPlacePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setIsEditAvatarPopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isDeleteCardPopupOpen=_React$useState8[0],setIsDeleteCardPopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isInfoTooltipPopupOpen=_React$useState10[0],setIsInfoTooltipPopupOpen=_React$useState10[1];var _React$useState11=React.useState(),_React$useState12=_slicedToArray(_React$useState11,2),selectedCard=_React$useState12[0],setSelectedCard=_React$useState12[1];var _React$useState13=React.useState(),_React$useState14=_slicedToArray(_React$useState13,2),currentUser=_React$useState14[0],setCurrentUser=_React$useState14[1];var _React$useState15=React.useState([]),_React$useState16=_slicedToArray(_React$useState15,2),cards=_React$useState16[0],setCards=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isLoading=_React$useState18[0],setIsLoading=_React$useState18[1];var _React$useState19=React.useState(),_React$useState20=_slicedToArray(_React$useState19,2),cardToDelete=_React$useState20[0],setCardToDelete=_React$useState20[1];var _React$useState21=React.useState(true),_React$useState22=_slicedToArray(_React$useState21,2),isSuccess=_React$useState22[0],setIsSuccess=_React$useState22[1];var _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),loggedIn=_React$useState24[0],setLoggedIn=_React$useState24[1];var _React$useState25=React.useState(\"\"),_React$useState26=_slicedToArray(_React$useState25,2),email=_React$useState26[0],setEmail=_React$useState26[1];var _React$useState27=React.useState(\"\"),_React$useState28=_slicedToArray(_React$useState27,2),password=_React$useState28[0],setPassword=_React$useState28[1];var _React$useState29=React.useState(),_React$useState30=_slicedToArray(_React$useState29,2),headerEmail=_React$useState30[0],setHeaderEmail=_React$useState30[1];React.useEffect(function(){var localEmailAddress=JSON.parse(localStorage.getItem(\"email address\"));setHeaderEmail(localEmailAddress);},[]);React.useEffect(function(){api.getUserInfo().then(function(res){setCurrentUser(res);}).catch(function(err){return console.log(err);});},[]);React.useEffect(function(){handleTokenCheck();},[]);function handleTokenCheck(){if(localStorage.getItem(\"token\")){var token=localStorage.getItem(\"token\");auth.checkToken(token).then(function(res){if(!res){return res.status(400).send({message:\"Token not provided or provided in the wrong format\"});}setLoggedIn(true);history.push(\"/\");}).catch(function(err){return console.log(err);});}}function handleEmailChange(e){localStorage.setItem(\"email address\",JSON.stringify(e.target.value));setHeaderEmail(e.target.value);setEmail(e.target.value);}function handlePasswordChange(e){setPassword(e.target.value);}function handleRegisterSubmit(e){e.preventDefault();auth.register(email,password).then(function(res){if(res){setIsSuccess(true);setIsInfoTooltipPopupOpen(true);setTimeout(function(){history.push(\"/login\");setIsInfoTooltipPopupOpen(false);},2000);setEmail(\"\");setPassword(\"\");}else{setIsSuccess(false);setIsInfoTooltipPopupOpen(true);setTimeout(function(){setIsInfoTooltipPopupOpen(false);},2000);console.log(\"Something went wrong\");}}).catch(function(err){return console.log(err);});}function handleLogin(e){e.preventDefault();setLoggedIn(true);}function handleLoginSubmit(e){e.preventDefault();auth.authorize(email,password).then(function(data){if(data.token){setEmail(\"\");setPassword(\"\");handleLogin(e);history.push(\"/\");}}).catch(function(err){return console.log(err);});}function handleLogoutSubmit(e){e.preventDefault();localStorage.removeItem(\"token\");localStorage.removeItem(\"email address\");setLoggedIn(false);history.push(\"/login\");}function handleEditProfileClick(){setIsLoading(false);setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsLoading(false);setIsAddPlacePopupOpen(true);}function handleEditAvatarClick(){setIsLoading(false);setIsEditAvatarPopupOpen(true);}function handleDeleteCardClick(clickedCard){setIsLoading(false);setIsDeleteCardPopupOpen(true);setCardToDelete(clickedCard);}function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsDeleteCardPopupOpen(false);setIsInfoTooltipPopupOpen(false);setSelectedCard();}function handleCardClick(clickedCard){setSelectedCard(clickedCard);}function handleUpdateUser(info){api.setUserInfo(info).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleUpdateAvatar(info){api.setUserAvatar(info).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleAddPlaceSubmit(_ref){var link=_ref.link,name=_ref.name;api.addCard({link:link,name:name}).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){return console.log(err);});}React.useEffect(function(){api.getCardList().then(function(res){setCards(res);}).catch(function(err){return console.log(err);});},[]);function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===(currentUser===null||currentUser===void 0?void 0:currentUser._id);});if(!isLiked){api.addLike(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){return console.log(err);});}else{api.removeLike(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){return console.log(err);});}}function handleCardDelete(card){api.removeCard(card._id).then(function(){setCards(function(state){return state.filter(function(c){return c._id!==card._id;});});closeAllPopups();}).catch(function(err){return console.log(err);});}function handleChangeButtonText(){setIsLoading(true);}return/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsxs(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,pageLink:\"\",linkTitle:\"Log out\",headerEmail:headerEmail,onLogoutSubmit:handleLogoutSubmit}),/*#__PURE__*/_jsx(Main,{onCardClick:handleCardClick,onEditProfileClick:handleEditProfileClick,onAddPlaceClick:handleAddPlaceClick,onEditAvatarClick:handleEditAvatarClick,cards:cards,onCardLike:handleCardLike,onDeleteCardClick:handleDeleteCardClick}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,isLoading:isLoading,onRenderLoading:handleChangeButtonText}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlaceSubmit:handleAddPlaceSubmit,isLoading:isLoading,onRenderLoading:handleChangeButtonText}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar,isLoading:isLoading,onRenderLoading:handleChangeButtonText}),/*#__PURE__*/_jsx(DeleteCardPopup,{cardToDelete:cardToDelete,isOpen:isDeleteCardPopupOpen,onClose:closeAllPopups,onDeleteCardSubmit:handleCardDelete,isLoading:isLoading,onRenderLoading:handleChangeButtonText}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups})]}),/*#__PURE__*/_jsx(Route,{path:\"/login\",children:/*#__PURE__*/_jsx(Login,{email:email,password:password,setEmail:setEmail,setPassword:setPassword,onEmailChange:handleEmailChange,onPasswordChange:handlePasswordChange,onLoginSubmit:handleLoginSubmit,setIsInfoTooltipPopupOpen:setIsInfoTooltipPopupOpen})}),/*#__PURE__*/_jsx(Route,{path:\"/register\",children:/*#__PURE__*/_jsx(Register,{email:email,password:password,setEmail:setEmail,setPassword:setPassword,onEmailChange:handleEmailChange,onPasswordChange:handlePasswordChange,onRegisterSubmit:handleRegisterSubmit,setIsInfoTooltipPopupOpen:setIsInfoTooltipPopupOpen})})]}),/*#__PURE__*/_jsx(InfoTooltip,{isSuccess:isSuccess,isOpen:isInfoTooltipPopupOpen,onClose:closeAllPopups})]});}export default App;","map":{"version":3,"sources":["/Users/colinmaretsky/dev/react-around-api-full/frontend/src/components/App.js"],"names":["React","Switch","Route","useHistory","Header","Main","Footer","EditProfilePopup","AddPlacePopup","EditAvatarPopup","DeleteCardPopup","ImagePopup","Login","Register","api","CurrentUserContext","InfoTooltip","ProtectedRoute","auth","App","history","useState","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isDeleteCardPopupOpen","setIsDeleteCardPopupOpen","isInfoTooltipPopupOpen","setIsInfoTooltipPopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","isLoading","setIsLoading","cardToDelete","setCardToDelete","isSuccess","setIsSuccess","loggedIn","setLoggedIn","email","setEmail","password","setPassword","headerEmail","setHeaderEmail","useEffect","localEmailAddress","JSON","parse","localStorage","getItem","getUserInfo","then","res","catch","err","console","log","handleTokenCheck","token","checkToken","status","send","message","push","handleEmailChange","e","setItem","stringify","target","value","handlePasswordChange","handleRegisterSubmit","preventDefault","register","setTimeout","handleLogin","handleLoginSubmit","authorize","data","handleLogoutSubmit","removeItem","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleDeleteCardClick","clickedCard","closeAllPopups","handleCardClick","handleUpdateUser","info","setUserInfo","handleUpdateAvatar","setUserAvatar","handleAddPlaceSubmit","link","name","addCard","newCard","getCardList","handleCardLike","card","isLiked","likes","some","i","_id","addLike","state","map","c","removeLike","handleCardDelete","removeCard","filter","handleChangeButtonText"],"mappings":"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","sourcesContent":["/* eslint-disable no-restricted-globals */\nimport React from \"react\";\nimport { Switch, Route, useHistory } from \"react-router-dom\";\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport DeleteCardPopup from \"./DeleteCardPopup\";\nimport ImagePopup from \"./ImagePopup\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport api from \"../utils/api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport * as auth from \"../utils/auth.js\";\n\nfunction App() {\n  const history = useHistory();\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] =\n    React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] =\n    React.useState(false);\n  const [isDeleteCardPopupOpen, setIsDeleteCardPopupOpen] =\n    React.useState(false);\n  const [isInfoTooltipPopupOpen, setIsInfoTooltipPopupOpen] =\n    React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState();\n  const [currentUser, setCurrentUser] = React.useState();\n  const [cards, setCards] = React.useState([]);\n  const [isLoading, setIsLoading] = React.useState(false);\n  const [cardToDelete, setCardToDelete] = React.useState();\n  const [isSuccess, setIsSuccess] = React.useState(true);\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [email, setEmail] = React.useState(\"\");\n  const [password, setPassword] = React.useState(\"\");\n  const [headerEmail, setHeaderEmail] = React.useState();\n\n  React.useEffect(() => {\n    const localEmailAddress = JSON.parse(localStorage.getItem(\"email address\"));\n    setHeaderEmail(localEmailAddress);\n  }, []);\n\n  React.useEffect(() => {\n    api\n      .getUserInfo()\n      .then((res) => {\n        setCurrentUser(res);\n      })\n      .catch((err) => console.log(err));\n  }, []);\n\n  React.useEffect(() => {\n    handleTokenCheck();\n  }, []);\n\n  function handleTokenCheck() {\n    if (localStorage.getItem(\"token\")) {\n      const token = localStorage.getItem(\"token\");\n\n      auth\n        .checkToken(token)\n        .then((res) => {\n          if (!res) {\n            return res.status(400).send({\n              message: \"Token not provided or provided in the wrong format\",\n            });\n          }\n          setLoggedIn(true);\n          history.push(\"/\");\n        })\n        .catch((err) => console.log(err));\n    }\n  }\n\n  function handleEmailChange(e) {\n    localStorage.setItem(\"email address\", JSON.stringify(e.target.value));\n    setHeaderEmail(e.target.value);\n    setEmail(e.target.value);\n  }\n\n  function handlePasswordChange(e) {\n    setPassword(e.target.value);\n  }\n\n  function handleRegisterSubmit(e) {\n    e.preventDefault();\n    auth\n      .register(email, password)\n      .then((res) => {\n        if (res) {\n          setIsSuccess(true);\n          setIsInfoTooltipPopupOpen(true);\n          setTimeout(() => {\n            history.push(\"/login\");\n            setIsInfoTooltipPopupOpen(false);\n          }, 2000);\n          setEmail(\"\");\n          setPassword(\"\");\n        } else {\n          setIsSuccess(false);\n          setIsInfoTooltipPopupOpen(true);\n          setTimeout(() => {\n            setIsInfoTooltipPopupOpen(false);\n          }, 2000);\n          console.log(\"Something went wrong\");\n        }\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleLogin(e) {\n    e.preventDefault();\n    setLoggedIn(true);\n  }\n\n  function handleLoginSubmit(e) {\n    e.preventDefault();\n    auth\n      .authorize(email, password)\n      .then((data) => {\n        if (data.token) {\n          setEmail(\"\");\n          setPassword(\"\");\n          handleLogin(e);\n          history.push(\"/\");\n        }\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleLogoutSubmit(e) {\n    e.preventDefault();\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"email address\");\n    setLoggedIn(false);\n    history.push(\"/login\");\n  }\n\n  function handleEditProfileClick() {\n    setIsLoading(false);\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsLoading(false);\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    setIsLoading(false);\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleDeleteCardClick(clickedCard) {\n    setIsLoading(false);\n    setIsDeleteCardPopupOpen(true);\n    setCardToDelete(clickedCard);\n  }\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsDeleteCardPopupOpen(false);\n    setIsInfoTooltipPopupOpen(false);\n    setSelectedCard();\n  }\n\n  function handleCardClick(clickedCard) {\n    setSelectedCard(clickedCard);\n  }\n\n  function handleUpdateUser(info) {\n    api\n      .setUserInfo(info)\n      .then((res) => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleUpdateAvatar(info) {\n    api\n      .setUserAvatar(info)\n      .then((res) => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleAddPlaceSubmit({ link, name }) {\n    api\n      .addCard({ link, name })\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  React.useEffect(() => {\n    api\n      .getCardList()\n      .then((res) => {\n        setCards(res);\n      })\n      .catch((err) => console.log(err));\n  }, []);\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some((i) => i._id === currentUser?._id);\n    if (!isLiked) {\n      api\n        .addLike(card._id, !isLiked)\n        .then((newCard) => {\n          setCards((state) =>\n            state.map((c) => (c._id === card._id ? newCard : c))\n          );\n        })\n        .catch((err) => console.log(err));\n    } else {\n      api\n        .removeLike(card._id, !isLiked)\n        .then((newCard) => {\n          setCards((state) =>\n            state.map((c) => (c._id === card._id ? newCard : c))\n          );\n        })\n        .catch((err) => console.log(err));\n    }\n  }\n\n  function handleCardDelete(card) {\n    api\n      .removeCard(card._id)\n      .then(() => {\n        setCards((state) => state.filter((c) => c._id !== card._id));\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleChangeButtonText() {\n    setIsLoading(true);\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <Switch>\n        <ProtectedRoute exact path=\"/\" loggedIn={loggedIn}>\n          <Header\n            loggedIn={loggedIn}\n            pageLink=\"\"\n            linkTitle=\"Log out\"\n            headerEmail={headerEmail}\n            onLogoutSubmit={handleLogoutSubmit}\n          />\n          <Main\n            onCardClick={handleCardClick}\n            onEditProfileClick={handleEditProfileClick}\n            onAddPlaceClick={handleAddPlaceClick}\n            onEditAvatarClick={handleEditAvatarClick}\n            cards={cards}\n            onCardLike={handleCardLike}\n            onDeleteCardClick={handleDeleteCardClick}\n          />\n          <Footer />\n          <EditProfilePopup\n            isOpen={isEditProfilePopupOpen}\n            onClose={closeAllPopups}\n            onUpdateUser={handleUpdateUser}\n            isLoading={isLoading}\n            onRenderLoading={handleChangeButtonText}\n          />\n          <AddPlacePopup\n            isOpen={isAddPlacePopupOpen}\n            onClose={closeAllPopups}\n            onAddPlaceSubmit={handleAddPlaceSubmit}\n            isLoading={isLoading}\n            onRenderLoading={handleChangeButtonText}\n          />\n          <EditAvatarPopup\n            isOpen={isEditAvatarPopupOpen}\n            onClose={closeAllPopups}\n            onUpdateAvatar={handleUpdateAvatar}\n            isLoading={isLoading}\n            onRenderLoading={handleChangeButtonText}\n          />\n          <DeleteCardPopup\n            cardToDelete={cardToDelete}\n            isOpen={isDeleteCardPopupOpen}\n            onClose={closeAllPopups}\n            onDeleteCardSubmit={handleCardDelete}\n            isLoading={isLoading}\n            onRenderLoading={handleChangeButtonText}\n          />\n          <ImagePopup card={selectedCard} onClose={closeAllPopups} />\n        </ProtectedRoute>\n        <Route path=\"/login\">\n          <Login\n            email={email}\n            password={password}\n            setEmail={setEmail}\n            setPassword={setPassword}\n            onEmailChange={handleEmailChange}\n            onPasswordChange={handlePasswordChange}\n            onLoginSubmit={handleLoginSubmit}\n            setIsInfoTooltipPopupOpen={setIsInfoTooltipPopupOpen}\n          />\n        </Route>\n        <Route path=\"/register\">\n          <Register\n            email={email}\n            password={password}\n            setEmail={setEmail}\n            setPassword={setPassword}\n            onEmailChange={handleEmailChange}\n            onPasswordChange={handlePasswordChange}\n            onRegisterSubmit={handleRegisterSubmit}\n            setIsInfoTooltipPopupOpen={setIsInfoTooltipPopupOpen}\n          />\n        </Route>\n      </Switch>\n      <InfoTooltip\n            isSuccess={isSuccess}\n            isOpen={isInfoTooltipPopupOpen}\n            onClose={closeAllPopups}\n          />\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}